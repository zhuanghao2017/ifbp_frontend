/**
 * Created by chief on 16/5/26.
 */

var WidgetEditTool=React.createClass({name:"WidgetEditTool",displayName:"WidgetEditTool",getInitialState:function(){return{}},render:function(){return React.createElement("ul",{className:"list-unstyled edit"},React.createElement("li",null,React.createElement("button",{className:"btn btn-round btn-default btn-outline btn-pill-left","data-type":"edit","data-toggle":"modal","data-target":"#modalBlue"},React.createElement("i",{"aria-hidden":"true",className:"icon wb-pencil"}),"\u7f16\u8f91")),React.createElement("li",
    null,React.createElement("button",{className:"btn btn-default btn-outline","data-type":"del"},"\u5220\u9664")),React.createElement("li",null,React.createElement("button",{className:"btn btn-default btn-outline","data-type":"collage"},React.createElement("i",{className:"icon wb-menu"}))),React.createElement("li",null,React.createElement("button",{className:"btn btn-round btn-default btn-outline btn-pill-right","data-type":"window"},React.createElement("i",{className:"icon wb-fullscreen"}))))}}),Widget=
    React.createClass({name:"Widget",displayName:"Widget",getWidgetMeta:function(){return this.props.layoutContext.layoutMeta[this.props.gadgetURL]},getInitialState:function(){var b=this.getWidgetMeta(),a=this.props.view;a||(a="default");var c="loading...",c=b.error?b.error.message:b.contents[a];return{html:c}},componentWillMount:function(){},componentDidMount:function(){if(!this.state.html){var b=this.getWidgetMeta(),a="default";$.each(b.views,function(b,c){a=b;return!1});if("default"!=a){var c=this.props.layoutContext.container;
        c.renderGadget(b.iframeUrls[a],this.props.id,"url")}else c=this.props.layoutContext.container,c.renderGadget(this.props.gadgetURL,this.props.id)}this.isMounted()&&this.state.html&&(b=$.parseHTML(this.state.html,!0))&&this.domManip(b);this.setPubSub()},componentWillUnmount:function(){},setPubSub:function(){this.state.html&&ReactDOM.findDOMNode(this)},setWidgetEditTool:function(){return this.props.layoutContext.options.isWidgetEdit?React.createElement(WidgetEditTool,null):""},render:function(){var isUrl = false;var widgetMeta = this.getWidgetMeta();if(!this.state.html){var widgetMeta = this.getWidgetMeta();var view = 'default' ;$.each( widgetMeta.views, function(v, n){view = v;return false;});if(view != 'default'){isUrl = true;}};return React.createElement("div",
        null,React.createElement("div",{id:"gadget-site-"+this.props.id,"data-id":this.props.id,className:this.props.layoutContext.options.isSortable?"well sort":"unsortable"},this.props.layoutContext.options.isShowWidgetName?React.createElement("h5",null,widgetMeta.modulePrefs.title):"",React.createElement("div",{id: 'gadget-site-content-'+this.props.id,className:isUrl?"innerHtml-ipad collapse in":"innerHtml collapse in",dangerouslySetInnerHTML:{__html:this.state.html}}),this.setWidgetEditTool()))},domManip:function(b){var a,c,d=0;c=this.getAll(b,"script");if(b=c.length)for(var f=/^$|\/(?:java|ecma)script/i,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,d=0;d<b;d++)if(a=c[d],f.test(a.type||"")&&!jQuery._data(a,"globalEval"))if(a.src){if(jQuery._evalUrl){a=a.src;if(window.baseUrl&&-1==a.indexOf(window.baseUrl)){a=a.split("//");var g=a[1].indexOf("/");a=a[0]+"//"+a[1].substring(0,g)+window.baseUrl+a[1].substring(g,a[1].length)}jQuery._evalUrl(a)}}else jQuery.globalEval((a.text||a.textContent||a.innerHTML||"").replace(e,""))},getAll:function(b,a){var c,d,f=0,e="undefined"!==typeof b.getElementsByTagName?
        b.getElementsByTagName(a||"*"):"undefined"!==typeof b.querySelectorAll?b.querySelectorAll(a||"*"):void 0;if(!e)for(e=[],c=b.childNodes||b;null!=(d=c[f]);f++)!a||jQuery.nodeName(d,a)?e.push(d):jQuery.merge(e,this.getAll(d,a));return void 0===a||a&&jQuery.nodeName(b,a)?jQuery.merge([b],e):e}}),WidgetBox=React.createClass({displayName:"WidgetBox",getInitialState:function(){return{gridData:[]}},componentDidMount:function(){var b=ReactDOM.findDOMNode(this);this.setWidgetDrag(b)},setWidgetDrag:function(b){this.props.layoutContext.options.isSortable&&
$(b).sortable({connectWith:".widgetBox",forcePlaceholderSize:!0,placeholder:"ui-portlet-placeholder",stop:function(a){},over:function(){}})},render:function(){var b=this.props.id;return React.createElement("div",{id:this.props.id,key:this.props.id,className:"widgetBox connectedSortable"},React.Children.map(this.props.children,function(a){if(a.type.displayName&&"Widget"===a.type.displayName)return React.createElement(Widget,{id:a.props.id,key:a.props.id,className:a.props.className+" ui-sortable-handle",
    layoutContext:a.props.layoutContext,gadgetURL:a.props.gadgetURL,widgetBoxId:b})}))}});

